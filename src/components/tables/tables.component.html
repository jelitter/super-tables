<div class="box-border flex flex-col min-w-[15.75rem] w-[15.75rem] h-full overflow-hidden text-sm left" [@fadeInOut]>
  <form [noValidate]="true" (change)="onSettingsChange()" class="flex flex-col">
    <div class="flex flex-col gap-1 p-2 pb-1 settings">
      <label for="layout" class="flex h-6 gap-2 rounded-full cursor-pointer hover:bg-slate-500/10">
        <label
          class="w-8 h-5 transition-colors bg-white border rounded-full dark:bg-transparent swap swap-rotate text-primary border-primary"
        >
          <input type="checkbox" [(ngModel)]="isVertical" name="layout" id="layout" />
          <svg class="w-6 h-6 swap-on" viewBox="-4 -4 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M1.5 2H13.5C13.7761 2 14 2.22386 14 2.5V7H1V2.5C1 2.22386 1.22386 2 1.5 2ZM1 8V12.5C1 12.7761 1.22386 13 1.5 13H13.5C13.7761 13 14 12.7761 14 12.5V8H1ZM0 2.5C0 1.67157 0.671573 1 1.5 1H13.5C14.3284 1 15 1.67157 15 2.5V12.5C15 13.3284 14.3284 14 13.5 14H1.5C0.671573 14 0 13.3284 0 12.5V2.5Z"
              fill="currentColor"
            />
          </svg>
          <svg class="w-6 h-6 swap-off" viewBox="-4 -4 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M8 2H13.5C13.7761 2 14 2.22386 14 2.5V12.5C14 12.7761 13.7761 13 13.5 13H8V2ZM7 2H1.5C1.22386 2 1 2.22386 1 2.5V12.5C1 12.7761 1.22386 13 1.5 13H7V2ZM0 2.5C0 1.67157 0.671573 1 1.5 1H13.5C14.3284 1 15 1.67157 15 2.5V12.5C15 13.3284 14.3284 14 13.5 14H1.5C0.671573 14 0 13.3284 0 12.5V2.5Z"
              fill="currentColor"
            />
          </svg>
        </label>
        <span class="cursor-pointer text">{{ isVertical ? 'Vertical' : 'Horizontal' }} layout</span>
      </label>

      <label class="flex items-center h-6 gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input
          type="checkbox"
          name="headers"
          [(ngModel)]="showHeaders"
          class="toggle toggle-sm toggle-primary"
          [disabled]="showAllHorizontalLines"
        />
        Headers 1st row
      </label>
      <label class="flex items-center h-6 gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input
          type="checkbox"
          name="horizontal-lines"
          [(ngModel)]="showAllHorizontalLines"
          class="toggle toggle-sm toggle-primary"
        />
        All horizontal lines
      </label>
      <label class="flex items-center h-6 gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input
          type="checkbox"
          name="allow-multiple-tables"
          [(ngModel)]="allowMultipleTables"
          class="toggle toggle-sm toggle-primary"
        />
        Allow multiple tables
      </label>
      <label class="flex items-center h-6 gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input type="checkbox" name="show-dash" [(ngModel)]="showEmptyAsDash" class="toggle toggle-sm toggle-primary" />
        Show empty as <code class="px-1 rounded bg-slate-500/10"> &mdash; </code>
      </label>
      <label class="flex items-center h-6 gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input
          type="checkbox"
          name="show-header-controls"
          [(ngModel)]="showHeaderControls"
          class="toggle toggle-sm toggle-primary"
        />
        Show header controls
      </label>
    </div>

    <div class="m-0 divider"></div>

    <div class="flex flex-col gap-1 px-2 py-1 border-style">
      <label class="p-0 cursor-pointer label">
        Border Style
        <!-- <span class="label-text">Border Style</span> -->
      </label>
      <label class="flex items-center gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input type="radio" name="border" value="norc" [(ngModel)]="border" class="radio radio-primary" />
        Single
      </label>
      <label class="flex items-center gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input type="radio" name="border" value="honeywell" [(ngModel)]="border" class="radio radio-primary" />
        Double
      </label>
      <label class="flex items-center gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input type="radio" name="border" value="ramac" [(ngModel)]="border" class="radio radio-primary" />
        ASCII
      </label>
      <label class="flex items-center gap-2 text-sm align-middle rounded-full cursor-pointer hover:bg-slate-500/10">
        <input type="radio" name="border" value="void" [(ngModel)]="border" class="radio radio-primary" />
        None
      </label>
    </div>

    <div class="m-0 divider"></div>

    <div class="box-border flex flex-col gap-2 px-2 py-1">
      <label class="p-0 cursor-pointer label">
        <span class="h-5 label-text"
          >Separator: <span class="italic">{{ activeSeparator }}</span>
          <span *ngIf="separator === Separators.AUTO_DETECT" class="text-2xs"> (auto)</span>
        </span>
      </label>
      <div class="justify-center h-10 overflow-hidden btn-group">
        <input
          type="radio"
          name="options"
          data-title="Auto"
          class="w-12 h-10 bg-opacity-50 border-none text-2xs btn btn-xs"
          [value]="Separators.AUTO_DETECT"
          [checked]="separator === Separators.AUTO_DETECT && !customSeparator"
          [(ngModel)]="separator"
        />
        <input
          type="radio"
          name="options"
          data-title="Tab"
          class="w-12 h-10 bg-opacity-50 border-none text-2xs btn btn-xs"
          [value]="Separators.TAB"
          [checked]="separator === Separators.TAB && !customSeparator"
          [(ngModel)]="separator"
        />
        <input
          type="radio"
          name="options"
          data-title="4 Spaces"
          class="h-10 bg-opacity-50 border-none w-14 text-2xs btn btn-xs"
          [value]="Separators.FOUR_SPACES"
          [checked]="separator === Separators.FOUR_SPACES && !customSeparator"
          [(ngModel)]="separator"
        />
        <input
          type="radio"
          name="options"
          data-title=","
          class="w-10 h-10 bg-opacity-50 border-none text-2xs btn btn-xs"
          [value]="Separators.COMMA"
          [checked]="separator === Separators.COMMA && !customSeparator"
          [(ngModel)]="separator"
        />
        <input
          type="radio"
          name="options"
          data-title="|"
          class="h-10 bg-opacity-50 border-none w-11 text-2xs btn btn-xs"
          [value]="Separators.PIPE"
          [checked]="separator === Separators.PIPE && !customSeparator"
          [(ngModel)]="separator"
        />
      </div>
      <div class="form-control">
        <label class="cursor-pointer input-group input-group-sm">
          <span>Custom</span>
          <input
            type="text"
            class="w-full input input-bordered input-sm"
            name="separator"
            [(ngModel)]="customSeparator"
            (input)="onSettingsChange()"
          />
        </label>
      </div>
    </div>

    <div class="m-0 divider"></div>

    <div class="px-2 py-1 tips">
      <label class="p-0 cursor-pointer label">
        <div class="label-text">Tips:</div>
      </label>

      <p class="p-0 text-sm">Add <code class="text">---</code> for horizontal divider</p>
    </div>
  </form>

  <ng-container *ngIf="showDebug">
    <div class="m-0 divider" [@fadeInOut]></div>
    <div class="box-border flex flex-col h-full gap-1 m-1 overflow-hidden scroll-auto">
      <div class="p-1 text-xs dark:text-black/90 bg-slate-400">
        <div>Hovered: {{ hoveredSubTable }}</div>
        <div>isVertical: {{ isVertical }}</div>
      </div>
      <pre class="h-auto p-1 overflow-auto text-xs dark:text-black/90 bg-slate-300 min-h-[30%]">{{
        selectedColumns | json
      }}</pre>
      <pre class="h-auto p-1 overflow-auto text-xs dark:text-black/90 bg-slate-400">{{ columnConfigs | json }}</pre>
    </div>
  </ng-container>
</div>

<div class="w-1 m-0 divider divider-horizontal"></div>

<!-- <div class="right p-0 grid grid-rows-[1fr_2px_1fr] gap-2 w-full overflow-hidden relative" [@fadeInOut]> -->
<div class="relative flex w-full p-0 overflow-hidden right" [@fadeInOut]>
  <label for="url-modal" class="fixed mt-3 btn-sm btn btn-accent modal-button right-14"> URL </label>

  <div
    #input
    id="input-text"
    class="absolute px-4 py-2 overflow-auto text-sm transition-all right-top outline-0 :active:border-2"
    [ngClass]="{ 'w-full h-1/2': isVertical, 'w-1/2 h-full': !isVertical }"
    contenteditable="true"
    (input)="onInputChanged($event)"
  ></div>

  <button
    class="absolute transition-all btn btn-circle top-4 btn-xs"
    [ngClass]="{ ' right-6': isVertical, 'right-[calc(50%+1rem)]': !isVertical }"
    *ngIf="(inputText ?? '').length > 0"
    (click)="clearInput()"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>

  <!-- <div
    class="relative flex justify-center transition-transform top-4 tooltip tooltip-left tooltip-info"
    data-tip="Clear input"
    [ngClass]="{ 'translate-x-full': isVertical, 'translate-x-1/2': !isVertical }"
  >
    <button class="absolute mr-10 btn btn-circle btn-xs" *ngIf="(inputText ?? '').length > 0" (click)="clearInput()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div> -->

  <!-- <div class="h-1 m-0 divider"></div> -->

  <div
    class="relative w-full overflow-auto transition-transform h-1/2"
    [ngClass]="{
      'h-1/2 translate-y-full border-t-slate-500/20 border-t-2': isVertical,
      'w-1/2 translate-x-full border-l-slate-500/20 border-l-2': !isVertical
    }"
  >
    <div class="absolute flex-col w-full h-full ml-1 bg-scroll columns-controls" [@fadeInOut]>
      <ng-container *ngFor="let configs of columnConfigs; let i = index; trackBy: trackByIndex">
        <div
          class="absolute transition-opacity"
          (mouseenter)="onMouseEnter(i)"
          [ngStyle]="{ 'margin-top': 'calc(' + getSubTableMarginTop(i) + 'px + 26px)' }"
          [class.opacity-100]="showHeaderControls || hoveredSubTable === i"
          [ngClass]="{
            'opacity-0 pointer-events-none': !showHeaderControls && hoveredSubTable !== i,
            'opacity-100 pointer-events-all': showHeaderControls || hoveredSubTable === i
          }"
        >
          <div class="z-40 dropdown">
            <label tabindex="0" class="w-6 h-6 rounded-full btn btn-xs btn-primary">
              <i class="fa-solid fa-table-columns"></i>
            </label>
            <ng-select
              tabindex="0"
              class="w-fit min-w-[300px] h-8 dropdown-content"
              [appearance]="'headers'"
              [closeOnSelect]="false"
              [multiple]="true"
              [items]="configs"
              [bindLabel]="'header'"
              [bindValue]="'id'"
              (ngModelChange)="onSelectedHeadersChanged()"
              [(ngModel)]="selectedColumns[i]"
            >
            </ng-select>
          </div>
        </div>

        <div
          class="absolute w-8 transition-all"
          [ngStyle]="{
            height: configs[0].height + 'px)',
            'margin-top': configs[0].height - 20 + 'px',
            'margin-left': getSubTableWidth(i) + 'px'
          }"
        >
          <button
            class="relative z-20 w-8 h-6 transition-all rounded btn btn-primary btn-xs"
            [class.btn-success]="copiedSubTable === i"
            (mouseenter)="onMouseEnter(i)"
            [ngStyle]="{ 'margin-top': 'calc(' + getSubTableMarginTop(i) + 'px)' }"
            [class.opacity-100]="showHeaderControls || hoveredSubTable === i"
            [ngClass]="{
              'opacity-0 pointer-events-none': !showHeaderControls && hoveredSubTable !== i,
              'opacity-100 pointer-events-all': showHeaderControls || hoveredSubTable === i
            }"
            (click)="copySubTable(i)"
          >
            <i class="fas fa-copy"></i>
          </button>
        </div>
      </ng-container>
    </div>

    <div class="absolute z-10 w-full h-full bg-scroll">
      <ul
        *ngFor="let configs of columnConfigs; let i = index; trackBy: trackByIndex"
        class="absolute flex m-0 h-auto pl-[20px]"
        [ngStyle]="{ 'margin-top': getSubTableMarginTop(i) + 'px' }"
        (mouseenter)="onMouseEnter(i)"
        (mouseleave)="onMouseLeave()"
      >
        <ng-container *ngFor="let config of configs; let j = index; trackBy: trackByIndex">
          <li
            *ngIf="isSelected(i, config)"
            [ngStyle]="{
              width: config.width.px + 16 + 'px',
              height: config.height + 16 + 'px',
              marginLeft: (j === 0 ? -8 : -16) + 'px'
            }"
            class="rounded opacity-0 inline-table mt-[-4px] transition-all p-1"
            [class.opacity-100]="showHeaderControls"
            [ngClass]="{
              'hover:opacity-100 hover:bg-slate-300/20 dark:hover:bg-slate-500/20 drop-shadow': !showHeaderControls
            }"
          >
            <div class="justify-center btn-group flex-nowrap" [@fadeInOut]="showHeaderControls">
              <button
                class="btn w-6 h-4 text-[10px] btn-square btn-xs rounded-l-full"
                (click)="alignColumn(i, j, 'left')"
                [class.btn-secondary]="getColumnAlignment(i, j) === 'left'"
              >
                <i class="fa-solid fa-align-left"></i>
              </button>
              <button
                class="btn w-4 h-4 text-[10px] btn-square btn-xs rounded-none"
                (click)="alignColumn(i, j, 'center')"
                [class.btn-secondary]="getColumnAlignment(i, j) === 'center'"
              >
                <i class="fa-solid fa-align-center"></i>
              </button>
              <button
                class="btn w-6 h-4 text-[10px] btn-square btn-xs rounded-r-full"
                (click)="alignColumn(i, j, 'right')"
                [class.btn-secondary]="getColumnAlignment(i, j) === 'right'"
              >
                <i class="fa-solid fa-align-right"></i>
              </button>
            </div>
          </li>
        </ng-container>
      </ul>
    </div>

    <div
      id="output-text"
      class="absolute w-full h-full p-4 overflow-auto text-sm leading-[17px] transition-all right-bottom border-slate-500 inline-table"
      [class.dark:text-green-500]="copied"
      [@fadeInOut]="uuid"
    >{{ outputText }}</div>
  </div>

  <button
    class="absolute gap-2 transition-colors opacity-0 btn btn-primary btn-sm bottom-4 right-4 w-28"
    [class.opacity-100]="outputText.length > 0"
    [class.btn-success]="copied"
    (click)="copyToClipboard()"
  >
    <i class="fas fa-copy"></i>
    {{ copied ? 'Copied!' : 'Copy' }}
  </button>
</div>

<input type="checkbox" id="url-modal" class="absolute modal-toggle" />
<div class="modal">
  <div class="relative modal-box">
    <label for="url-modal" class="absolute btn btn-sm btn-circle right-2 top-2">âœ•</label>
    <div class="w-full form-control">
      <label class="w-full label">
        <span class="label-text">Enter URL to fetch a JSON array of objects:</span>
      </label>
      <input
        type="text"
        placeholder="URL here..."
        class="w-full input input-bordered"
        [class.input-error]="urlInput && !isUrlInputValid"
        [class.input-success]="isUrlInputValid"
        [(ngModel)]="urlInput"
      />
      <label class="label">
        <span class="label-text-alt"></span>
        <span class="label-text-alt">{{ urlInput ? (isUrlInputValid ? 'Valid URL' : 'Invalid URL') : '' }}</span>
      </label>
    </div>
    <div class="modal-action">
      <label
        for="url-modal"
        class="flex items-center gap-2 btn"
        [ngClass]="{ 'btn-disabled': !isUrlInputValid }"
        (click)="fetchUrl()"
      >
        <i class="fas fa-sync-alt"></i>
        Fetch
      </label>
    </div>
  </div>
</div>
